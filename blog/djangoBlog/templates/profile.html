{% extends "base.html" %}
{% load i18n %}

{% block content %}
<div class="row">
    <div class="col-md-2">
        <img src={{ userinfo.avatar.url }} width="130" height="130"/>
        {% if me %}
            <p></p>
            <form action="." method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input id="choose-avatar" style="display: none;" type="file" name="avatar" onchange="this.form.submit()"/>
            </form>
            <button id="change-avatar" class="btn btn-primary">Change Avatar</button>
        {% endif %}
    </div>
    <div class="col-md-8">
        <h2 style="margin-top: 0;" class="align-left"><strong>{{ userinfo.user.username }}</strong></h2>
        {% if me %}
        <input class="btn btn-primary align-right" type="button" data-name="show" value="Edit About" id="edit_about"/>
        {% endif %}
        <hr class="clear-both">
        <p id="about">{{ userinfo.about }}</p>
        {% if me %}
        <div id="about-edit" style="display: none;">
            <form action="." method="post">
                {% csrf_token %}
                <textarea class="comment_area" name="about" type="text" required>{{ userinfo.about }}</textarea>
                <p></p>
                <input type="submit" class="btn btn-primary submit-right" name="submit" value="Submit"/>
            </form>
        </div>
        {% endif %}
    </div>
    <div class="col-md-2">
        <h4><strong>Statistics</strong></h4><hr>
        <p><strong>Read: </strong>{{ read.count }}</p>
        <p><strong>Own: </strong>{{ own.count }}</p>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h3>My Books</h3><hr>
        <form action="." method="get">
            <input class="btn btn-primary {% if option != 'Want' and option != 'Own' and option != 'Read' %}btn-negate{% endif %}" type="submit" name="option" value="All"/>
            <input class="btn btn-primary {% if option == 'Want' %}btn-negate{% endif %}" type="submit" name="option" value="Want"/>
            <input class="btn btn-primary {% if option == 'Own' %}btn-negate{% endif %}" type="submit" name="option" value="Own"/>
            <input class="btn btn-primary {% if option == 'Read' %}btn-negate{% endif %}" type="submit" name="option" value="Read"/>
        </form>
        <table id="books-table" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Cover</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>My Score</th>
                    <th>Published</th>
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                <tr class='clickable-row' data-href="/book/{{ book.id }}">
                    <td><img src={{ book.cover.url }} height="96" width="64"/></td>
                    <td>{{ book.title }}</td>
                    <td>{{ book.author }}</td>
                    <td>{{ book.score }}</td>
                    <td>{{ book.publish_date }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#books-table').DataTable({
            order: [[ 1, "desc" ]],
            columns: [
                null,
                null,
                null,
                { "searchable": false },
                null
            ]
        });

        $('.clickable-row').click(function() {
            window.location = $(this).data("href");
        });

        $('#change-avatar').click(function() {
            $('#choose-avatar').click();
        });

        $('#edit_about').click(function() {
            if ($(this).data('name') == 'show') {
                $('#about').hide()
                $('#about-edit').show()
                $(this).data('name', 'hide')
            } else {
                $('#about').show()
                $('#about-edit').hide()
                $(this).data('name', 'show')
            }
        });
    });
</script>
{% endblock %}